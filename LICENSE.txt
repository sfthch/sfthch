The MIT License (MIT)

Copyright (c) 2019 Samarjeet

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

<select id="inquiryReservationUseDetailBase" resultType="ReservationDetail">
    <![CDATA[
    	SELECT	
    	/* mrserver.mapper.reservation.ReservationUseMapper.inquiryReservationUseDetailBase */
				A.MEMB_SQNO
		,		A.MBLT_SRVC_CLSS_CD
		,		(
				SELECT Y.CMMN_CD_NM
				FROM TBMSM311 X
				INNER JOIN TBMSM312 Y ON X.CMMN_CD_GRP_SQNO = Y.CMMN_CD_GRP_SQNO
				WHERE 1 = 1
				AND X.USE_YN = 'Y'
				AND Y.USE_YN = 'Y'
				AND X.CMMN_CD_GRP_ID = "MBLT_SRVC_CLSS_CD"
				AND Y.CMMN_CD_ID = A.MBLT_SRVC_CLSS_CD
				) AS MBLT_SRVC_CLSS_NM
		,		A.RSEV_STAT_CD
		,		(
				SELECT Y.CMMN_CD_NM
				FROM TBMSM311 X
				INNER JOIN TBMSM312 Y ON X.CMMN_CD_GRP_SQNO = Y.CMMN_CD_GRP_SQNO
				WHERE 1 = 1
				AND X.USE_YN = 'Y'
				AND Y.USE_YN = 'Y'
				AND X.CMMN_CD_GRP_ID = "RSEV_STAT_CD"
				AND Y.CMMN_CD_ID = A.RSEV_STAT_CD
				) AS RSEV_STAT_NM
		,		A.PROD_RIDE_NMPR_CNT
		,		A.RSEV_SEAT_NO_VAL
		,		(
				SELECT	ROUTE_NM
				FROM	TBMSM212 B
				WHERE	B.ROUTE_ID = A.ROUTE_ID
				) AS ROUTE_ID
		,		(
				SELECT	RENTS_NM
				FROM	TBMSM217 B
				WHERE	B.RENTS_ID = A.RENTS_ID
				) AS RENTS_ID
		,		(
				SELECT	STN_NM
				FROM	TBMSM211 B
				WHERE	B.STN_ID = A.DPRST_ID
				AND		B.MBLT_SYSTM_CLSS_CD = A.MBLT_SYSTM_CLSS_CD
		        AND		B.MBLT_SRVC_CLSS_CD = A.MBLT_SRVC_CLSS_CD
		        AND		B.AFFI_CLSS_CD = A.AFFI_CLSS_CD
				) AS DPRST_ID
		,		(
				SELECT	STN_NM
				FROM	TBMSM211 B
				WHERE	B.STN_ID = A.ARVST_ID
				AND		B.MBLT_SYSTM_CLSS_CD = A.MBLT_SYSTM_CLSS_CD
		        AND		B.MBLT_SRVC_CLSS_CD = A.MBLT_SRVC_CLSS_CD
		        AND		B.AFFI_CLSS_CD = A.AFFI_CLSS_CD
				) AS ARVST_ID
		,		DATE_FORMAT(A.DPRST_ARRV_SCDL_DTTM, '%Y-%m-%d %H:%i:%s') AS DPRST_ARRV_SCDL_DTTM
		,		DATE_FORMAT(A.ARVST_ARRV_SCDL_DTTM, '%Y-%m-%d %H:%i:%s') AS ARVST_ARRV_SCDL_DTTM
		,		A.RSEV_DTRM_NO_VAL
		,		DATE_FORMAT(A.RSEV_RQST_DTTM, '%Y-%m-%d %H:%i:%s') AS RSEV_RQST_DTTM
		,		DATE_FORMAT(A.RSEV_STRT_DTTM, '%Y-%m-%d %H:%i:%s') AS RSEV_STRT_DTTM
		,		DATE_FORMAT(A.RSEV_CNCL_DTTM, '%Y-%m-%d %H:%i:%s') AS RSEV_CNCL_DTTM
		,		DATE_FORMAT(A.UTLZ_STRT_DTTM, '%Y-%m-%d %H:%i:%s') AS UTLZ_STRT_DTTM
		,		DATE_FORMAT(A.UTLZ_END_DTTM, '%Y-%m-%d %H:%i:%s') AS UTLZ_END_DTTM
		,		DATE_FORMAT(A.RSEV_END_DTTM, '%Y-%m-%d %H:%i:%s') AS RSEV_END_DTTM
		,		B.PROD_NM AS USE_PROD_NM
		,		B.UTLZ_VAL AS USE_PROD_CNT
		,		C.USE_AMT
		,		D.VHCL_ID
		,		D.VHCL_BRND_NM 	AS VHCL_NM
		,		D.VHCL_NO_VAL	AS VHCL_NO
		,		D.FUEL_TYPE_NM	AS FUEL_TYPE
		,		D.VHCL_IMG		AS VHCL_IMG
		FROM	TBMSD106 A
		LEFT OUTER JOIN (
							SELECT	AA.RSEV_SQNO
							,		BB.PROD_NM
							,		SUM(AA.UTLZ_VAL) AS UTLZ_VAL
							FROM 	TBMSD114 AA
							LEFT OUTER JOIN (
											SELECT	A1.PROD_PUCH_SQNO
											,		A2.PROD_NM
											FROM	TBMSD103 A1
											LEFT OUTER JOIN TBMSM102 A2
											ON		A1.PROD_SQNO = A2.PROD_SQNO
											) BB
							ON	AA.PROD_PUCH_SQNO = BB.PROD_PUCH_SQNO
							GROUP BY AA.RSEV_SQNO
							,		BB.PROD_NM
		                    ) B
			ON	A.RSEV_SQNO = B.RSEV_SQNO 
		    LEFT OUTER JOIN (
							SELECT	RSEV_DTRM_NO_VAL
							,		SUM(CASE WHEN PAYM_CLSS_CD = '1' THEN PAYM_APRV_AMT ELSE PAYM_APRV_AMT*-1 END) AS USE_AMT
							FROM	TBMSD105 A
							WHERE	1=1
							AND		RSEV_DTRM_NO_VAL IS NOT NULL
							AND		RSEV_DTRM_NO_VAL <> ""
							AND		MBLT_SRVC_CLSS_CD IN ('10','40')
							GROUP BY RSEV_DTRM_NO_VAL
							) C
		    ON 	A.RSEV_DTRM_NO_VAL = C.RSEV_DTRM_NO_VAL 
		    LEFT OUTER JOIN TBMSM214 D
		    ON 		A.VHCL_ID = D.VHCL_ID
			AND		A.MBLT_SRVC_CLSS_CD = D.MBLT_SRVC_CLSS_CD
		WHERE	A.RSEV_SQNO = #{rsevSqno}
		AND		A.MEMB_SQNO = #{membSqno}
	]]>
    </select>
	
